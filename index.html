<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get IT Done</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#E5F3FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Get IT Done">
    <link rel="icon" type="image/svg+xml" href="./icons/icon.svg">
    <link rel="apple-touch-icon" href="./icons/icon.svg">
</head>
<body>
    <div class="container">
        <section class="tasks-section" id="activeTasks">
            <div class="section-header">
                <h2>Get them done!</h2>
                <div class="header-actions">
                    <button id="enablePush" class="button-secondary">Enable reminders</button>
                    <span class="task-count"></span>
                </div>
            </div>
            <div class="tasks-list"></div>
        </section>

        <section class="tasks-section" id="completedTasks">
            <div class="section-header">
                <h2>Done!</h2>
                <span class="task-count"></span>
            </div>
            <div class="tasks-list"></div>
        </section>

        <!-- Add Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">Add New Task</h2>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Title</label>
                        <input type="text" id="taskTitle" required>
                    </div>

                    <div class="form-group">
                        <label for="taskDueDate">Due Date & Time</label>
                        <input type="datetime-local" id="taskDueDate">
                    </div>

                    <div class="form-group">
                        <label for="taskNotes">Notes</label>
                        <textarea id="taskNotes"></textarea>
                    </div>

                    <div class="form-buttons">
                        <button type="button" id="cancelTask" class="button-secondary">Cancel</button>
                        <button type="submit" class="button-primary">Save Task</button>
                    </div>
                </form>
            </div>
        </div>

        <button id="addTaskBtn" class="add-button">
            <span>+</span>
        </button>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-messaging-compat.js"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="./app.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDVc8YtOD5Km-RDhGvww7x8WupcNSpWipc",
            authDomain: "get-it-done-52bb1.firebaseapp.com",
            projectId: "get-it-done-52bb1",
            storageBucket: "get-it-done-52bb1.appspot.com",
            messagingSenderId: "1076164214014",
            appId: "1:1076164214014:web:483731f66c0d931e9ef9af",
            measurementId: "G-69EG6J8WCD"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Setup Firebase Cloud Messaging
        const messaging = firebase.messaging();

        async function subscribeToPush() {
            /* Must run from a real click (Safari requirement) */
            const perm = await Notification.requestPermission();
            if (perm !== 'granted') return;

            /* Your public VAPID key exactly as generated */
            const token = await messaging.getToken({
                vapidKey: 'BPtAmMri69KCwIpo7q93PR-aYE5EdPlFJqpoFUXatOQzRjgAbxKrTt4mw5WtmjpuBVF8rzaeoBxepIwSUUb7s14'
            });

            console.log('FCM token â†’', token);
            /* Store token in IndexedDB for now */
            await db.pushTokens.add({ token, createdAt: new Date() });
            
            // Update button state
            const enablePushBtn = document.getElementById('enablePush');
            if (enablePushBtn) {
                enablePushBtn.textContent = 'Reminders Enabled';
                enablePushBtn.disabled = true;
            }
        }

        document.getElementById('enablePush').onclick = subscribeToPush;

        // Initialize managers after all scripts are loaded
        window.taskManager = new TaskManager();
        window.modalManager = new ModalManager();
        window.taskManager.renderTasks();
    </script>
</body>
</html> 
